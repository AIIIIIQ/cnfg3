# Учебный конфигурационный язык - Парсер

## 1. Общее описание

Данный проект представляет собой инструмент командной строки для парсинга учебного конфигурационного языка и преобразования его в формат JSON. Инструмент читает входной файл с конфигурацией на специальном языке, обнаруживает синтаксические ошибки и выводит результат в виде JSON-файла.

**Особенности:**

- **Поддержка основных конструкций языка:**
  - **Однострочные комментарии**: `% Это однострочный комментарий`.
  - **Многострочные комментарии**: `--[[ Это многострочный комментарий ]]`.
  - **Массивы**: `( значение, значение, значение, ... )`.
  - **Словари**:
    ```
    {
        ИМЯ = значение
        ИМЯ = значение
        ...
    }
    ```
  - **Имена**: последовательности заглавных букв `[A-Z]+`.
  - **Значения**: числа, массивы, словари.
  - **Объявление констант** на этапе трансляции: `var ИМЯ := значение;`.
  - **Вычисление констант** на этапе трансляции: `|ИМЯ|`.

- **Выявление синтаксических ошибок** с выводом понятных сообщений.
- **Покрытие тестами** всех конструкций языка и возможных ошибок.
- **Строгое соответствие** заданному синтаксису без дополнительных расширений.

---

## 2. Описание всех функций и настроек

### Класс `ConfigParser`

Основной класс, отвечающий за парсинг конфигурационного файла.

#### Атрибуты:

- `self.constants`: Словарь для хранения объявленных констант.
- `self.tokens`: Список токенов, полученных после токенизации входного текста.
- `self.pos`: Текущая позиция в списке токенов при парсинге.

#### Методы:

- **`tokenize(self, text)`**: Токенизирует входной текст, удаляя комментарии и разбивая текст на токены.

  - **Описание процесса:**
    - **Удаление комментариев**: однострочных (`% ...`) и многострочных (`--[[ ... ]]`).
    - **Определение спецификации токенов**: числа, имена, ключевые слова, операторы и т.д.
    - **Разбор текста на токены** с помощью регулярных выражений.
    - **Обработка токенов** и добавление их в `self.tokens`.

- **`parse(self)`**: Запускает процесс парсинга токенов и возвращает результирующую структуру данных.

  - **Описание процесса:**
    - Инициализация пустого списка результатов.
    - Последовательный вызов `parse_value()` для каждого токена.
    - Возврат единственного результата или списка результатов.

- **`parse_value(self)`**: Парсит значение на основе текущего токена.

  - **Описание процесса:**
    - Проверяет текущий токен и вызывает соответствующий метод парсинга:
      - `parse_var()` для объявления константы.
      - `parse_eval()` для вычисления константы.
      - `parse_assignment()` для присваивания значения имени.
      - Возвращает число, массив или словарь в зависимости от токена.

- **`parse_assignment(self)`**: Парсит присваивание значения имени (e.g., `NAME = value`).

- **`parse_array(self)`**: Парсит массив (e.g., `(value, value, ...)`) и возвращает список.

- **`parse_dict(self)`**: Парсит словарь (e.g., `{ NAME = value ... }`) и возвращает словарь.

- **`parse_var(self)`**: Парсит объявление константы (e.g., `var NAME := value;`) и сохраняет ее в `self.constants`.

- **`parse_eval(self)`**: Парсит вычисление константы (e.g., `|NAME|`) и возвращает ее значение из `self.constants`.

- **`match(self, kind)`**: Проверяет, соответствует ли текущий токен ожидаемому типу `kind`.

- **`consume(self, kind)`**: Потребляет текущий токен, если он соответствует типу `kind`, и продвигает позицию `self.pos`.

### Функция `main()`

- Обрабатывает аргументы командной строки (`-i` для входного файла и `-o` для выходного файла).
- Читает входной файл, инициирует парсер и запускает процесс парсинга.
- Обрабатывает исключения и выводит сообщения об ошибках.
- Сохраняет результат парсинга в указанный JSON-файл.

---

## 3. Описание команд для сборки проекта

Для запуска парсера вам понадобится установленный **Python версии 3.6** или выше.

**Команды для запуска парсера:**

```bash
python config_parser.py -i <входной_файл> -o <выходной_файл>
```

**Примеры:**

- Парсинг файла `network_config.cfg` и сохранение результата в `network_config.json`:

  ```bash
  python config_parser.py -i network_config.cfg -o network_config.json
  ```

- Парсинг файла `experiment_config.cfg` и сохранение результата в `experiment_config.json`:

  ```bash
  python config_parser.py -i experiment_config.cfg -o experiment_config.json
  ```

---

## 4. Результаты прогона тестов

Проект снабжен автоматическими тестами, покрывающими все конструкции языка и возможные ошибки. Для запуска тестов выполните команду:

```bash
python test_config_parser.py
```

**Ожидаемый вывод:**

```
...............
----------------------------------------------------------------------
Ran 15 tests in 0.005s

OK
```

**Объяснение:**

- **15 тестов**, покрывающих числа, массивы, словари, объявления и вычисления констант, комментарии и синтаксические ошибки.
- **Все тесты проходят успешно**, что подтверждает корректность работы парсера.

---

## 5. Примеры конфигураций из разных предметных областей

### **Пример 1: Настройка сетевого оборудования**

**Файл `network_config.cfg`:**

```
% Настройка сетевого оборудования

var MAX_USERS := 100;

DEVICE = {
    ID = 1
    MODE = 0
    LIMITS = {
        MAX_USERS = |MAX_USERS|
        MIN_USERS = 1
    }
    PORTS = (8080, 8081, 8082)
}
```

**Запуск парсера:**

```bash
python config_parser.py -i network_config.cfg -o network_config.json
```

**Результат (`network_config.json`):**

```json
{
    "DEVICE": {
        "ID": 1,
        "MODE": 0,
        "LIMITS": {
            "MAX_USERS": 100,
            "MIN_USERS": 1
        },
        "PORTS": [8080, 8081, 8082]
    }
}
```

---

### **Пример 2: Параметры физического эксперимента**

**Файл `experiment_config.cfg`:**

```
--[[ Параметры физического эксперимента ]]

var INITIAL_VALUES := (0, 0, 9.8);

EXPERIMENT = {
    DURATION = 120
    SAMPLE_RATE = 1000
    INITIAL_VALUES = |INITIAL_VALUES|
    SETTINGS = {
        MODE = 1
        SENSORS = {
            COUNT = 3
            TYPES = (1, 2, 3)
        }
    }
}
```

**Запуск парсера:**

```bash
python config_parser.py -i experiment_config.cfg -o experiment_config.json
```

**Результат (`experiment_config.json`):**

```json
{
    "EXPERIMENT": {
        "DURATION": 120,
        "SAMPLE_RATE": 1000,
        "INITIAL_VALUES": [0, 0, 9.8],
        "SETTINGS": {
            "MODE": 1,
            "SENSORS": {
                "COUNT": 3,
                "TYPES": [1, 2, 3]
            }
        }
    }
}
```

---

## 6. Примечания

- **Строгое соответствие заданию:** Парсер реализует только те конструкции, которые описаны в задании, без дополнительных расширений.
- **Кодировка файлов:** Убедитесь, что все файлы сохранены в кодировке UTF-8.
- **Версия Python:** Скрипт разработан для работы на **Python 3.6** и выше.
- **Обработка ошибок:** Парсер корректно выявляет синтаксические ошибки и выводит понятные сообщения об ошибках, указывая на проблему.

---

## 7. Запуск тестов

**Файл с тестами:** `test_config_parser.py`

**Запуск тестов:**

```bash
python test_config_parser.py
```

**Тесты покрывают:**

- **Числа:** проверка парсинга целых и вещественных чисел.
- **Массивы:** парсинг простых и вложенных массивов.
- **Словари:** парсинг простых и вложенных словарей.
- **Константы:** объявление и использование констант.
- **Комментарии:** обработка однострочных и многострочных комментариев.
- **Синтаксические ошибки:** проверка обработки различных ошибок парсинга.

---
